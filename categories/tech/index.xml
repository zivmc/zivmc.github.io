<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>tech on Ziv&#39;s Blog</title>
    <link>https://zivmc.github.io/categories/tech/</link>
    <description>Recent content in tech on Ziv&#39;s Blog</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Mon, 28 Oct 2019 16:50:52 +0800</lastBuildDate>
    
	<atom:link href="https://zivmc.github.io/categories/tech/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>subprocess 模块使用 bash 运行命令并捕捉输出</title>
      <link>https://zivmc.github.io/posts/python-subprocess-capture-output/</link>
      <pubDate>Mon, 28 Oct 2019 16:50:52 +0800</pubDate>
      
      <guid>https://zivmc.github.io/posts/python-subprocess-capture-output/</guid>
      <description>背景是使用 Python 写脚本编译 Android 10 源码时，源码的某些 Makefile 文件会检查正在使用的 shell， 并根据使用的 shell 是 bash 或 zsh，定义不同的 check_type() 函数：
function validate_current_shell() { local current_sh=&amp;#34;$(ps -o command -p $$)&amp;#34; case &amp;#34;$current_sh&amp;#34; in *bash*) function check_type() { type -t &amp;#34;$1&amp;#34;; } ;; *zsh*) function check_type() { type &amp;#34;$1&amp;#34;; } enable_zsh_completion ;; *) echo -e &amp;#34;WARNING: Only bash and zsh are supported.\nUse of other shell would lead to erroneous results.&amp;#34; ;; esac } 之前实现的脚本中，os.system() 函数，以及默认的 subprocess 模块，都会调用 /bin/sh 执行命令。 尽管 /bin/sh 指向的是 /bin/bash，这里还是不能正确定义出 check_type() 函数。</description>
    </item>
    
    <item>
      <title>从 Android 6.0 factory image 中提取驱动</title>
      <link>https://zivmc.github.io/posts/android-6.0-extract-drivers-from-factory-image/</link>
      <pubDate>Thu, 10 Oct 2019 01:07:49 +0800</pubDate>
      
      <guid>https://zivmc.github.io/posts/android-6.0-extract-drivers-from-factory-image/</guid>
      <description>背景是 Google 的 Driver Binaries 页面不提供 Android 6.0 的驱动，Android 6.0 之前和之后的驱动都有提供。这里介绍一种使用 android-prepare-vendor 工具从 factory image 中提取驱动的方法。
准备 工具  android-prepare-vendor 工具 android-prepare-vendor 依赖的其他工具，android-simg2img、dexRepair 等，可根据 android-prepare-vendor 运行时的错误信息搜索安装  修改 android-prepare-vendor 我使用的最新 commit 为 e853d17c89f6962d3fd6f408db8576e6b445f643 的版本，在处理中间文件时会有一些权限问题，因此需要打上下面这个 patch：
diff --git a/scripts/generate-vendor.sh b/scripts/generate-vendor.sh index b7c96a5..a601ac4 100755 --- a/scripts/generate-vendor.sh +++ b/scripts/generate-vendor.sh @@ -217,6 +217,10 @@ extract_blobs() { # writing to destination) outPath=&amp;#34;$outBase/$dstDir/$(basename &amp;#34;$src&amp;#34;)&amp;#34; + if test -f &amp;#34;$outPath&amp;#34;; then + chmod +rwx $outPath + fi + cp -a &amp;#34;$inDir/$src&amp;#34; &amp;#34;$outPath&amp;#34; || { echo &amp;#34;[-] Failed to copy &amp;#39;$src&amp;#39;&amp;#34; abort 1 -- 2.</description>
    </item>
    
  </channel>
</rss>